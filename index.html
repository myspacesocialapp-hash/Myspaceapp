<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Space</title>

  <!-- PWA + iOS support -->
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icons/icon-512.png">
  <meta name="theme-color" content="#0d1117">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Space">

  <style>
    :root{--bg:#ffffff;--card:#ffffff;--text:#0b1220;--muted:#6b7280;--accent:#2563eb}
    .dark{--bg:#0b1220;--card:#0f1724;--text:#f8fafc;--muted:#9ca3af;--accent:#3b82f6}
    html,body,#root{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:Inter,Segoe UI,Roboto,Helvetica,Arial}
    .container{max-width:960px;margin:0 auto;padding:16px}
    .card{background:var(--card);border-radius:8px;padding:12px;box-shadow:0 1px 4px rgba(2,6,23,0.06);margin-bottom:12px}
    .row{display:flex;gap:8px;align-items:center}
    .btn{background:var(--accent);color:#fff;padding:8px 12px;border-radius:6px;border:none;cursor:pointer}
    .btn-ghost{background:transparent;border:1px solid #ddd;padding:6px 10px;border-radius:6px;cursor:pointer}
    input,textarea,select{padding:8px;border:1px solid #e5e7eb;border-radius:6px;width:100%;background:transparent;color:var(--text)}
    textarea{min-height:80px;resize:vertical}
    .small{font-size:13px;color:var(--muted)}
    .avatar{width:48px;height:48px;border-radius:999px;object-fit:cover}
    .story{width:64px;height:64px;border-radius:999px;object-fit:cover;border:2px solid var(--accent);cursor:pointer}
    .hidden{display:none}
    .mt{margin-top:12px}
    .mb{margin-bottom:12px}
    .badge{background:#e6f0ff;color:#08306b;padding:4px 8px;border-radius:999px;font-size:12px}
    .danger{background:#fee2e2;color:#7f1d1d}
    .flex{display:flex}
    .col{display:flex;flex-direction:column}
    .space-x{gap:8px}
    a{color:var(--accent);text-decoration:none}
    .topbar{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:12px}
    .search-input{width:280px}
    .post-media{max-width:100%;max-height:380px;border-radius:8px}
    .cover{height:160px;background:#ccc;border-radius:8px 8px 0 0;object-fit:cover;width:100%}
    .center{text-align:center}
    .splash{position:fixed;inset:0;background:var(--bg);display:flex;align-items:center;justify-content:center;z-index:9999;flex-direction:column}
    .splash .logo{font-size:28px;font-weight:800;margin-bottom:8px}
    @media (max-width:640px){.search-input{width:140px}}
    /* diagnostics */
    #space-diagnostics{position:fixed;left:8px;right:8px;top:8px;padding:10px;background:#ffeedd;border:2px solid #ff7a45;z-index:99999;font-family:Arial,Helvetica,sans-serif;display:none}
  </style>

  <!-- CONFIG: fixed SPACE_CONFIG -->
  <script>
    window.SPACE_CONFIG = {
      firebaseConfig: {
        apiKey: "AIzaSyClhomaPlXVrk_xeD0_jXHx3x1IPzvHH0s",
        authDomain: "my-space-app-9d39e.firebaseapp.com",
        projectId: "my-space-app-9d39e",
        storageBucket: "my-space-app-9d39e.appspot.com",
        messagingSenderId: "567017323339",
        appId: "1:567017323339:web:78cb093d20e6090da806ce"
      },
      cloudinary: {
        cloudName: "deobpcudu",
        uploadPreset: "myuploads"
      },
      ADMIN_EMAIL: "myspacesocialapp@gmail.com"
    };
  </script>
</head>
<body>
  <!-- Diagnostic box -->
  <div id="space-diagnostics"><b>Space — diagnostic</b><div id="space-diagnostics-msg" style="margin-top:6px;font-size:13px;color:#333">Waiting...</div><button id="space-diagnostics-clear" style="margin-top:8px;padding:6px 8px;border:none;background:#2563eb;color:white;border-radius:6px;cursor:pointer">Hide</button></div>
  <script>
    (function(){
      const box = document.getElementById('space-diagnostics');
      const msg = document.getElementById('space-diagnostics-msg');
      const btn = document.getElementById('space-diagnostics-clear');
      btn.onclick = ()=> box.style.display='none';
      function showError(e){
        box.style.display = 'block';
        const text = (typeof e === 'string') ? e : (e && (e.message || e.stack || JSON.stringify(e))) || 'Unknown error';
        msg.innerText = text;
        console.error('Space diagnostic:', e);
      }
      window.addEventListener('error', (ev)=> { showError(ev.error || ev.message || 'Script error'); });
      window.addEventListener('unhandledrejection', (ev)=> { showError('Unhandled promise rejection: ' + (ev.reason && (ev.reason.message || ev.reason))); });
      window.SPACE_APP_OK = ()=> { box.style.display='block'; msg.innerText='App mounted successfully ✔'; setTimeout(()=> box.style.display='none', 2200); };
      window.addEventListener('load', ()=>{
        const c = window.SPACE_CONFIG && window.SPACE_CONFIG.firebaseConfig;
        if (!c || !c.apiKey || c.apiKey.includes('YOUR_')) showError('Firebase config placeholders not replaced.');
        const cl = window.SPACE_CONFIG && window.SPACE_CONFIG.cloudinary;
        if (!cl || !cl.cloudName || !cl.uploadPreset || cl.cloudName.includes('YOUR_')) showError('Cloudinary config placeholders not replaced.');
      });
    })();
  </script>

  <!-- Splash -->
  <div id="splash" class="splash">
    <div class="logo">Space</div>
    <div class="small">Welcome — loading Space…</div>
  </div>

  <div id="root" class="container" style="visibility:hidden"></div>

  <!-- React + Firebase App code -->
  <script type="module">
    import React, { useEffect, useState } from 'https://cdn.jsdelivr.net/npm/react@18.2.0/+esm';
    import { createRoot } from 'https://cdn.jsdelivr.net/npm/react-dom@18.2.0/+esm';
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, sendEmailVerification, sendPasswordResetEmail, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";
    import { getFirestore, collection, doc, setDoc, getDoc, addDoc, query, where, getDocs, orderBy, onSnapshot, updateDoc, deleteDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";
    import { getStorage } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-storage.js";

    const CONFIG = window.SPACE_CONFIG || {};
    const firebaseConfig = CONFIG.firebaseConfig || {};
    const CLOUDINARY_CLOUD = (CONFIG.cloudinary && CONFIG.cloudinary.cloudName) || "";
    const CLOUDINARY_UPLOAD_PRESET = (CONFIG.cloudinary && CONFIG.cloudinary.uploadPreset) || "";
    const ADMIN_EMAIL = CONFIG.ADMIN_EMAIL || "";

    // init firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const storage = getStorage(app);

    // --- rest of your app code stays exactly as in your original HTML ---
    // mount
    const container = document.getElementById('root');
    createRoot(container).render(React.createElement(App));
    if (window.SPACE_APP_OK) window.SPACE_APP_OK();
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js').then(() => console.log('Service Worker registered')).catch((err) => console.log('Service Worker failed', err));
      });
    }
  </script>
</body>
</html>
